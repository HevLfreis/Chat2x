/*
  
  RollBar - jQuery ScrollBar Plugin
  -----------------------------------------------
  
  @author   flGravity
  @created  4/4/12
  @version  1.6
  @site     http://codecanyon.net/user/flGravity
  
*/

(function(a){function b(e,d){this.container=a(e);this.settings=d;this.timer=0;this.before={v:0,h:0};this.touch={};this.pressed=0;this.vslider=a("<div/>",{"class":"rollbar-handle"});this.vpath=a("<div/>",{"class":"rollbar-path-vertical"});this.hslider=a("<div/>",{"class":"rollbar-handle"});this.hpath=a("<div/>",{"class":"rollbar-path-horizontal"});this.sliders=this.vslider.add(this.hslider);this.container.css({position:"relative",overflow:"hidden"}).contents().filter(this.settings.contentFilter).wrapAll('<div class="rollbar-content"></div>');this.content=this.container.children(".rollbar-content").css({position:"relative",top:0,left:0,overflow:"hidden"});if(this.settings.scroll=="horizontal"){this.container.prepend(this.hpath.append(this.hslider))}else{if(this.settings.scroll=="vertical"){this.container.prepend(this.vpath.append(this.vslider))}else{this.container.prepend(this.vpath.append(this.vslider),this.hpath.append(this.hslider))}}this.vpath.add(this.hpath).css({"z-index":this.settings.zIndex,display:"none"});this.vslider.css({height:this.settings.sliderSize,opacity:this.settings.sliderOpacity});this.hslider.css({width:this.settings.sliderSize,opacity:this.settings.sliderOpacity});if(this.settings.sliderOpacity){this.sliders.hover(this.fixFn(function(){this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,1)}),this.fixFn(function(){if(!this.pressed){this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,this.settings.sliderOpacity)}}))}this.init();this.pathSize();this.bindEvent(a(window),"load",function(){setTimeout(this.fixFn(this.checkScroll),10)});if(this.settings.lazyCheckScroll>0){setInterval(this.fixFn(function(){this.checkScroll();this.pathSize()}),this.settings.lazyCheckScroll)}}b.prototype.checkScroll=function(){this.vtrack=this.vpath.height()-this.vslider.height();this.htrack=this.hpath.width()-this.hslider.width();this.vdiff=this.content.height()-this.container.height();this.hdiff=this.content.width()-this.container.width();if(!this.settings.autoHide){return}if(this.vdiff>0){this.vpath.fadeIn(this.settings.autoHideTime)}else{this.vpath.fadeOut(this.settings.autoHideTime)}if(this.hdiff>0){this.hpath.fadeIn(this.settings.autoHideTime)}else{this.hpath.fadeOut(this.settings.autoHideTime)}};b.prototype.pathSize=function(){var c=parseInt(this.settings.pathPadding,10);this.vpath.css({top:c+"px",height:this.container.height()-2*c+"px"});this.hpath.css({left:c+"px",width:this.container.width()-2*c+"px"})};b.prototype.scroll=function(c,f,g){var d=0;var i=0;if(c<0){c=0}if(c>this.vtrack){c=this.vtrack}this.vslider.css("top",c+"px");if(f<0){f=0}if(f>this.htrack){f=this.htrack}this.hslider.css("left",f+"px");if(this.vdiff>0){i=c/this.vtrack;this.content.css("top",Math.round(-this.vdiff*i));if(g&&(c&&c!=this.vtrack)){g.stopPropagation();g.preventDefault()}}if(this.hdiff>0){d=f/this.htrack;this.content.css("left",Math.round(-this.hdiff*d));if(g&&(f&&f!=this.htrack)){g.stopPropagation();g.preventDefault()}}if(this.before.v!=i||this.before.h!=d){if(typeof this.settings.onscroll=="function"){this.settings.onscroll.call(this.container.get(0),i,d)}this.before.v=i;this.before.h=d}};b.prototype.easeScroll=function(d,f){var j=0;var c=Math.floor(this.settings.scrollTime/this.settings.scrollInterval);var i=this.vslider.position().top;var e=this.hslider.position().left;var g=a.easing[this.settings.scrollEasing]||a.easing.linear;this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,1);window.clearInterval(this.timer);this.timer=window.setInterval(this.fixFn(function(){this.scroll(i+g(j/c,j,0,1,c)*d,e+g(j/c,j,0,1,c)*f);if(++j>c){window.clearInterval(this.timer);this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,this.settings.sliderOpacity)}}),this.settings.scrollInterval)};b.prototype.fixFn=function(e,d){var c=this;return function(){e.apply(d||c,Array.prototype.slice.call(arguments))}};b.prototype.bindEvent=function(c,h,g,d){return c.bind(h,this.fixFn(g,d))};b.prototype.init=function(){var c=a(window.document);this.bindEvent(this.sliders,"mousedown",function(j){this.pressed=(j.target===this.vslider.get(0))?1:2;var g=j.pageX;var f=j.pageY;var i=this.vslider.position().top;var h=this.hslider.position().left;this.bindEvent(c,"mousemove",function(k){if(this.pressed==1){this.scroll(i+(k.pageY-f),h)}else{this.scroll(i,h+(k.pageX-g))}});this.bindEvent(c,"selectstart",function(k){k.preventDefault()})});this.bindEvent(c,"mouseup",function(f){if(this.pressed==1&&f.target!==this.vslider.get(0)){this.vslider.fadeTo(this.settings.sliderOpacityTime,this.settings.sliderOpacity)}else{if(this.pressed==2&&f.target!==this.hslider.get(0)){this.hslider.fadeTo(this.settings.sliderOpacityTime,this.settings.sliderOpacity)}}this.pressed=0;c.unbind("mousemove");c.unbind("selectstart")});this.bindEvent(this.container,"touchstart",function(g){var f=g.originalEvent;var h=f.changedTouches[0];this.touch.sx=h.pageX;this.touch.sy=h.pageY;this.touch.sv=this.vslider.position().top;this.touch.sh=this.hslider.position().left;this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,1);if(this.settings.blockGlobalScroll&&(this.vdiff||this.hdiff)){f.stopPropagation()}});this.bindEvent(this.container,"touchmove",function(g){var f=g.originalEvent;var h=f.targetTouches[0];this.scroll(this.touch.sv+(this.touch.sy-h.pageY)*this.settings.touchSpeed,this.touch.sh+(this.touch.sx-h.pageX)*this.settings.touchSpeed,g);if(this.settings.blockGlobalScroll&&(this.vdiff||this.hdiff)){f.preventDefault();f.stopPropagation()}});this.bindEvent(this.container,"touchend touchcancel",function(g){var f=g.originalEvent;var h=f.changedTouches[0];this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,this.settings.sliderOpacity);if(this.settings.blockGlobalScroll&&(this.vdiff||this.hdiff)){f.stopPropagation()}});var d=this.vpath.height(),e=this.hpath.width();this.bindEvent(a(window),"resize",function(){this.pathSize();this.checkScroll();if(this.vdiff<=0){this.content.css("top",0)}if(this.hdiff<=0){this.content.css("left",0)}this.scroll(Math.round(parseInt(this.vslider.css("top"),10)*this.vpath.height()/d),Math.round(parseInt(this.hslider.css("left"),10)*this.hpath.width()/e));d=this.vpath.height();e=this.hpath.width()});this.bindEvent(this.container,"mousewheel",function(i,j,g,f){var h=i.target.nodeName;if(h=="TEXTAREA"||(h=="SELECT"||h=="OPTION")){i.stopPropagation();return}this.scroll(this.vslider.position().top-this.settings.wheelSpeed*f,this.hslider.position().left+this.settings.wheelSpeed*g,i);this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,1);window.clearTimeout(this.timer);this.timer=window.setTimeout(this.fixFn(function(){this.sliders.stop().fadeTo(this.settings.sliderOpacityTime,this.settings.sliderOpacity)}),this.settings.sliderOpacityDelay);if(this.settings.blockGlobalScroll&&(this.vdiff||this.hdiff)){i.preventDefault();i.stopPropagation()}});this.bindEvent(c,"keydown",function(h){var f=0,g=0;g=(h.keyCode==38)?-this.settings.keyScroll:g;g=(h.keyCode==40)?this.settings.keyScroll:g;f=(h.keyCode==37)?-this.settings.keyScroll:f;f=(h.keyCode==39)?this.settings.keyScroll:f;if(g||f){this.easeScroll(g,f)}});this.bindEvent(this.container,"dragstart",function(f){f.preventDefault()});this.bindEvent(this.container,"rollbar",function(j,f,i,g){j.stopPropagation();if(f==="reset"){this.container.find(".rollbar-content, .rollbar-handle").css({top:0,left:0});return}f=f||0;i=i||0;if(/^[-\d\.]+$/.test(f)){f=parseFloat(f);if(Math.abs(f)<=1&&!g){f*=this.vtrack}else{f=f+f*(this.vtrack/this.vdiff-1)}}if(/^[-\d\.]+$/.test(i)){i=parseFloat(i);if(Math.abs(i)<=1&&!g){i*=this.htrack}else{i=i+i*(this.htrack/this.hdiff-1)}}this.easeScroll(f,i)})};a.fn.rollbar=function(d){var c={scroll:"both",autoHide:true,autoHideTime:"fast",lazyCheckScroll:1000,blockGlobalScroll:false,contentFilter:"*",sliderSize:"30%",sliderOpacity:0.5,sliderOpacityTime:200,sliderOpacityDelay:1000,wheelSpeed:20,touchSpeed:0.3,pathPadding:"20px",keyScroll:100,scrollTime:500,scrollInterval:15,scrollEasing:"swing",zIndex:100,onscroll:function(){}};a.extend(c,d);return this.each(function(){new b(this,c)})}})(jQuery);